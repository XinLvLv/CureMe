<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <title>CareMe - Readings</title>
    <link rel="stylesheet" href="/static/css/bootstrap.min.css">
    <link rel="stylesheet" href="/static/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="/static/css/main.css">
    <link rel="shortcut icon" href="/static/image/icon.png" type="image/x-icon">
    <script src="/static/js/echarts.min.js"></script>
    <script src="/static/js/jquery-3.3.1.min.js"></script>
</head>
<body>
<!--header-->
<div class="header">
    <div class="row">
        <div class="col-md-2">
            <div class="logo">
                <img src="/static/image/logo.png" class="logo-image">
            </div>

        </div>
        <div class="col-md-1">
            <div class="header-font">
                <span class="fa fa-bars"></span>
            </div>
        </div>
        <div class="col-md-6"></div>
        <div class="col-md-1">
            <div class="header-font">
                <span class="fa fa-search"></span>
            </div>
        </div>
        <div class="col-md-1">
            <div class="header-font">
                <p>Family</p>
            </div>
        </div>
        <div class="col-md-1">
            <div class="doctor-avatar">
                <img src="/static/image/family.png" class="doctor-avatar-image">
            </div>
        </div>
    </div>
</div>
<!--end of header-->
<div class="row">
<!--    left side navigation bar-->
    <div class="col-md-3">
        <nav>
            <div class="nav-list">
                <a href="/family-member-home">
                    <div class="nav-item on-focus">
                        <span class="fa fa-home nav-item-icon on-focus"></span>
                        <span>Home</span>
                    </div>
                </a>
                <div class="nav-title">
                    <span>FEATURES</span>
                </div>
                <a href="/reading/submit-vital-signs-by-fm">
                    <div class="nav-item">
                        <span class="fa fa-calendar nav-item-icon"></span>
                        <span>Submit Vital Signs</span>
                    </div>
                </a>
                <a href="/reading/view-vital-sign-by-fm">
                    <div class="nav-item">
                        <span class="fa fa-line-chart nav-item-icon"></span>
                        <span>View Vital Signs</span>
                    </div>
                </a>
                <a href="/notification/view-notification-by-fm">
                    <div class="nav-item">
                        <span class="fa fa-pencil-square-o nav-item-icon"></span>
                        <span>Notice Board</span>
                    </div>
                </a>
                <a href="/">
                    <div class="nav-item">
                        <span class="fa fa-sign-out nav-item-icon"></span>
                        <span>Logout</span>
                    </div>
                </a>
            </div>
        </nav>
    </div>
<!--    end of left side navigation bar-->
    <div class="col-md-9">
        <!--selectbox of patients-->
        <div class="main-content select-box">
            <select onchange="location.href = this.options[this.selectedIndex].value">
                <option th:each="patient:${patients}" th:text="${patient.firstName + ' ' + patient.lastName}"
                        th:value="${'view-vital-sign-by-fm/'+patient.patientId}"></option>
            </select>
        </div>
        <!--end of selectbox of patients-->
        <!--empty box to remind the doctor of selecting a patient-->
        <div class="main-content main-content-associate" th:unless = ${selectedPatient}>
            <div>
                <span>Please Select A Patient To View His Vital Signs</span>
            </div>
        </div>
        <!--end of empty box-->
<!--        information of a patient's reading-->
        <div class="main-content" th:if = ${selectedPatient}>
            <div class="row">
                <div class="col-md-3">
                    <div class="patient-avatar">
                        <img class="patient-avatar-image" src="/static/image/patient.jpg">
                        <div class="patient-avatar-title">
                            <span th:text="${selectedPatient.firstName + ' ' + selectedPatient.lastName}"></span>
                        </div>
                    </div>
                </div>
                <div class="col-md-9">
                    <div class="patient-activity">
                        <div class="main-content-title patient-activity-title">
                            <span>Patient's Info</span>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-5">
                            <div class="total-reading">
                                <div class="reading-title">
                                    <span>Diseases</span>
                                </div>
                                <div class="reading-content total-reading-content">
                                    <span th:text="${selectedPatient.disease}"></span>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-7">
                            <div class="recommended-reading">
                                <div class="reading-title">
                                    <span>Recommended Reading/Day</span>
                                </div>
                                <div class="reading-content recommended-reading-content">
                                    <span th:text="${selectedPatient.schedule}"></span>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
<!--        end of information of a patient's reading-->
        <div>
            <div class="main-content" id="breathing_rate" style="width:100%; height:400px;" th:if = "${selectedPatient}">
            </div>
            <div class="main-content" id="gcs_score" style="width:100%; height:400px;" th:if = ${selectedPatient}>
            </div>
            <div class="main-content" id="systolic_BP" style="width:100%; height:400px;" th:if = ${selectedPatient}>
            </div>
            <div class="main-content" id="pulse" style="width:100%; height:400px;" th:if = ${selectedPatient}>
            </div>
            <div class="main-content" id="spo2" style="width:100%; height:400px;" th:if = ${selectedPatient}>
            </div>
            <div class="main-content" id="diastolic_BP" style="width:100%; height:400px;" th:if = ${selectedPatient}>
            </div>
        </div>
       </div>
</div>

<!--</script>-->
<script type="text/javascript" th:inline="javascript" th:if = ${selectedPatient}>
    // 基于准备好的dom，初始化echarts实例
    var breathingRateChart = echarts.init(document.getElementById('breathing_rate'));
    var gcsScoreChart = echarts.init(document.getElementById('gcs_score'));
    var systolicBPChart = echarts.init(document.getElementById('systolic_BP'));
    var pulseChart = echarts.init(document.getElementById('pulse'));
    var spo2Chart = echarts.init(document.getElementById('spo2'));
    var diastolicBPChart = echarts.init(document.getElementById('diastolic_BP'));

    // 新建productName与nums数组来接受数据，因为我们
    var datetime = [];
    var breathingRate = [];
    var systolicBP = [];
    var gcsScore = [];
    var spo2 = [];
    var pulse = [];
    var diastolicBP = [];

    //
    var specificUrl = "http://localhost:8080/reading/data/" + [[${selectedPatient.patientId}]];

    //AJAX接收数据主体
    $.ajax({
        type:"GET",
        url:specificUrl,
        dataType:"json",
        async:false,
        success:function (result) {
            for (var i = 0; i < result.length; i++){
                datetime.push(result[i].datetime);
                breathingRate.push(result[i].breathingRate);
                systolicBP.push(result[i].systolicBP);
                gcsScore.push(result[i].gcs);
                pulse.push(result[i].pulse);
                spo2.push(result[i].spo2);
                diastolicBP.push(result[i].diastolicBP);
            }
        },
        error :function(errorMsg) {
            alert("failed！");
        }
    });

    // 指定图表的配置项和数据
    var pulseOption = {
        title: {
            text: 'Pulse',
            left: '1%'
        },
        tooltip: {
            trigger: 'axis'
        },
        grid: {
            left: '5%',
            right: '15%',
            bottom: '10%'
        },
        xAxis: {
            data: datetime
        },
        yAxis: {},
        toolbox: {
            right: 10,
            feature: {
                dataZoom: {
                    yAxisIndex: 'none'
                },
                restore: {},
                saveAsImage: {}
            }
        },
        dataZoom: [{
            startValue: '2021-03-15T04:00:00.000+0000'
        }, {
            type: 'inside'
        }],
        visualMap: {
            top: 50,
            right: 10,
            pieces: [{
                gt: 0,
                lt: 60,
                color: '#FD0100'
            }, {
                gte: 60,
                lte: 100,
                color: '#93CE07'
            }, {
                gt: 100,
                color: '#FD0100'
            }],
            outOfRange: {
                color: '#999'
            }
        },
        series: {
            name: 'Pulse',
            type: 'line',
            data: pulse,
            markLine: {
                silent: true,
                lineStyle: {
                    color: '#333'
                },
                data: [{
                    yAxis: 60
                }, {
                    yAxis: 100
                }]
            }
        }
    };
    var breathingRateOption = {
        title: {
            text: 'Breathing Rate',
            left: '1%'
        },
        tooltip: {
            trigger: 'axis'
        },
        grid: {
            left: '5%',
            right: '15%',
            bottom: '10%'
        },
        xAxis: {
            data: datetime
        },
        yAxis: {},
        toolbox: {
            right: 10,
            feature: {
                dataZoom: {
                    yAxisIndex: 'none'
                },
                restore: {},
                saveAsImage: {}
            }
        },
        dataZoom: [{
            startValue: '2021-03-15T04:00:00.000+0000'
        }, {
            type: 'inside'
        }],
        visualMap: {
            top: 50,
            right: 10,
            pieces: [{
                gte: 0,
                lte: 22,
                color: '#93CE07'
            }, {
                gt: 22,
                color: '#FD0100'
            }],
            outOfRange: {
                color: '#999'
            }
        },
        series: {
            name: 'Breathing Rate',
            type: 'line',
            data: breathingRate,
            markLine: {
                silent: true,
                lineStyle: {
                    color: '#333'
                },
                data: [{
                    yAxis: 22
                }]
            }
        }
    };
    var spo2Option = {
        title: {
            text: 'SpO2',
            left: '1%'
        },
        tooltip: {
            trigger: 'axis'
        },
        grid: {
            left: '5%',
            right: '15%',
            bottom: '10%'
        },
        xAxis: {
            data: datetime
        },
        yAxis: {},
        toolbox: {
            right: 10,
            feature: {
                dataZoom: {
                    yAxisIndex: 'none'
                },
                restore: {},
                saveAsImage: {}
            }
        },
        dataZoom: [{
            startValue: '2021-03-15T04:00:00.000+0000'
        }, {
            type: 'inside'
        }],
        visualMap: {
            top: 50,
            right: 10,
            pieces: [{
                gte: 90,
                lte: 100,
                color: '#93CE07'
            }, {
                lt: 90,
                color: '#FD0100'
            }],
            outOfRange: {
                color: '#999'
            }
        },
        series: {
            name: 'SpO2',
            type: 'line',
            data: spo2,
            markLine: {
                silent: true,
                lineStyle: {
                    color: '#333'
                },
                data: [{
                    yAxis: 90
                }]
            }
        }
    };
    var gcsOption = {
        title: {
            text: 'GCS Score',
            left: '1%'
        },
        tooltip: {
            trigger: 'axis'
        },
        grid: {
            left: '5%',
            right: '15%',
            bottom: '10%'
        },
        xAxis: {
            data: datetime
        },
        yAxis: {},
        toolbox: {
            right: 10,
            feature: {
                dataZoom: {
                    yAxisIndex: 'none'
                },
                restore: {},
                saveAsImage: {}
            }
        },
        dataZoom: [{
            startValue: '2021-03-15T04:00:00.000+0000'
        }, {
            type: 'inside'
        }],
        visualMap: {
            top: 50,
            right: 10,
            pieces: [{
                gte: 15 ,
                color: '#93CE07'
            }, {
                lte: 14,
                gte:0,
                color: '#FD0100'
            }],
            outOfRange: {
                color: '#999'
            }
        },
        series: {
            name: 'GCS Score',
            type: 'line',
            data: gcsScore,
            markLine: {
                silent: true,
                lineStyle: {
                    color: '#333'
                },
                data: [{
                    yAxis: 15
                }]
            }
        }
    };
    var systolicBPOption = {
        title: {
            text: 'Systolic Blood Pressure',
            left: '1%'
        },
        tooltip: {
            trigger: 'axis'
        },
        grid: {
            left: '5%',
            right: '15%',
            bottom: '10%'
        },
        xAxis: {
            data: datetime
        },
        yAxis: {},
        toolbox: {
            right: 10,
            feature: {
                dataZoom: {
                    yAxisIndex: 'none'
                },
                restore: {},
                saveAsImage: {}
            }
        },
        dataZoom: [{
            startValue: '2021-03-15T04:00:00.000+0000'
        }, {
            type: 'inside'
        }],
        visualMap: {
            top: 50,
            right: 10,
            pieces: [{
                gte: 100,
                lte: 120,
                color: '#93CE07'
            }, {
                lt: 100,
                color: '#FD0100'
            }],
            outOfRange: {
                color: '#999'
            }
        },
        series: {
            name: 'Systolic Blood Pressure',
            type: 'line',
            data: systolicBP,
            markLine: {
                silent: true,
                lineStyle: {
                    color: '#333'
                },
                data: [{
                    yAxis: 100
                }]
            }
        }
    };
    var diastolicBPOption = {
        title: {
            text: 'Systolic Blood Pressure',
            left: '1%'
        },
        tooltip: {
            trigger: 'axis'
        },
        grid: {
            left: '5%',
            right: '15%',
            bottom: '10%'
        },
        xAxis: {
            data: datetime
        },
        yAxis: {},
        toolbox: {
            right: 10,
            feature: {
                dataZoom: {
                    yAxisIndex: 'none'
                },
                restore: {},
                saveAsImage: {}
            }
        },
        dataZoom: [{
            startValue: '2021-03-15T04:00:00.000+0000'
        }, {
            type: 'inside'
        }],
        visualMap: {
            top: 50,
            right: 10,
            pieces: [{
                gt: 60,
                lte: 90,
                color: '#93CE07'
            }, {
                lte: 60,
                color: '#FD0100'
            }],
            outOfRange: {
                color: '#999'
            }
        },
        series: {
            name: 'Diastolic Blood Pressure',
            type: 'line',
            data: diastolicBP,
            markLine: {
                silent: true,
                lineStyle: {
                    color: '#333'
                },
                data: [{
                    yAxis: 60
                }]
            }
        }
    };
    // 使用刚指定的配置项和数据显示图表。
    pulseChart.setOption(pulseOption);
    breathingRateChart.setOption(breathingRateOption);
    spo2Chart.setOption(spo2Option);
    gcsScoreChart.setOption(gcsOption);
    systolicBPChart.setOption(systolicBPOption);
    diastolicBPChart.setOption(diastolicBPOption);
</script>

</body>
</html>